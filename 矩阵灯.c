#include<reg51.h>
#include<intrins.h>

#define u8 unsigned char
#define u16 unsigned int
	
sbit SER = P3^4;//串行数据输入
sbit RCLK = P3^5;//存储寄存器时钟输入
sbit SRCLK = P3^6;//移位寄存器时钟输入
u8 code mylover[][8] = {{0x00,0x00,0x0C,0x02,0x02,0xFC,0x00,0x00},
			{0x00,0x00,0x7E,0x02,0x02,0x02,0x00,0x00},
		{0x00,0x44,0x28,0x10,0x28,0x44,0x00,0x00},
			{0x00,0x00,0x42,0x7E,0x42,0x00,0x00,0x00},
			{0x00,0x00,0x7E,0x02,0x02,0x02,0x00,0x00},
				{0x00,0x3C,0x42,0x42,0x42,0x3C,0x00,0x00},
					{0x00,0x78,0x04,0x02,0x04,0x78,0x00,0x00},
						{0x00,0x7C,0x54,0x54,0x54,0x00,0x00,0x00},
							{0x00,0x40,0x20,0x1E,0x20,0x40,0x00,0x00},
								{0x00,0x3C,0x42,0x42,0x42,0x3C,0x00,0x00},
									{0x00,0x7C,0x02,0x02,0x02,0x7C,0x00,0x00}};
u8 code smgduan[][8] = {{0x30,0x48,0x84,0x42,0x42,0x84,0x48,0x30},//列扫描
{0x00,0x30,0x48,0x24,0x24,0x48,0x30,0x00},
{0x00,0x30,0x78,0x3C,0x3C,0x78,0x30,0x00},
{0x00,0x00,0x30,0x18,0x18,0x30,0x00,0x00},
{0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0xCF,0xB7,0x7B,0xBD,0xBD,0x7B,0xB7,0xCF},
{0xCF,0xB7,0x4B,0xA5,0xA5,0x4B,0xB7,0xCF},
{0xCF,0x87,0x33,0xB9,0xB9,0x33,0x87,0xCF},
{0xCF,0x87,0x03,0xB1,0xB1,0x03,0x87,0xCF},
{0xCF,0x87,0x03,0x81,0x81,0x03,0x87,0xCF},
{0x30,0x78,0xFC,0x7E,0x7E,0xFC,0x78,0x30}};
u8 code smgwei[] = {0x7f,0xbf,0xdf,0xef,0xf7,0xfb,0xfd,0xfe};//选通某一列
int delay(u16 i)
{
	while(i--);
	return 1;
}


void HC595SendByte(u8 dat)//向74hc595发送一个字节,给行输入电平
{
	u8 a;
	RCLK = 0;
	SRCLK = 0;
	for(a =0;a < 8;a++)
	{
		SER = dat>>7;
		dat<<=1;
		SRCLK  = 1;
		_nop_();
		_nop_();
		SRCLK = 0;
	}
	RCLK = 1;
	_nop_();
	_nop_();
	RCLK = 0;
}
void main()
{
	u8 a = 0;
	u8 b = 0;
	u8 c = 40;
	while(1)
		{
			P0 = 0x02;
			for(b = 0; b < 12;b++)
			{
					do{for(a = 0;a < 8; a++)
					{
						P0 = smgwei[a];
						HC595SendByte(mylover[b][a]);
						delay(100);
						HC595SendByte(0x00);
					}}while(c--);
					c = 40;
				}
					for(b = 0; b < 12;b++)
				{
					do{for(a = 0;a < 8; a++)
					{
						P0 = smgwei[a];
						HC595SendByte(smgduan[b][a]);
						delay(100);
						HC595SendByte(0x00);
					}}while(c--);
					c = 40;
				}
			}
}